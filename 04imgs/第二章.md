---
# ä¸»é¢˜åˆ—è¡¨ï¼šjuejin, gihttps://github.com/it-beige/img-hostthub, smartblue, cyanosis, channing-cyan, fancy, hydrogen, condensed-night-purple, greenwillow, v-green, vue-pro, healer-readable, mk-cute, jzman, geek-black, awesome-green
# è´¡çŒ®ä¸»é¢˜ï¼šhttps://github.com/xitu/juejin-markdown-themes
theme: channing-cyan
highlight: vs2015
---

> book: `Vue Element+Node.js`å¼€å‘ä¼ä¸šé€šç”¨ç®¡ç†åå°ç³»ç»Ÿ[æ…•è¯¾ç½‘] 2021/3/14

## å‰è¨€

ç»§ä¸Šä¸€ç¯‡[ã€ä»¥æ¨¡å—åŒ–çš„æ€æƒ³æ¥æ­å»ºä¸­åå°é¡¹ç›®ã€‘](https://juejin.cn/post/6894412199700201485)ï¼Œæ—¶éš”ä¸€æœˆå†å¼€å§‹å†™è¯¥ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œæ²¡åŠæ³•æœ€è¿‘ç¡®å®æœ‰ç‚¹å¿™ï¼Œä¸åƒä»¥å‰åˆ’æ°´æ‘¸é±¼ï¼Œåˆ°ç‚¹å°±æºœğŸ˜­(y1s1è¿™æ®µæ—¶é—´ç¡®å®æŒºå¿™çš„)ï¼Œä¸è¿‡è¿™ä¸ªç³»åˆ—çš„æ–‡ç« æˆ‘è‚¯å®šä¼šå¥½å¥½èŠ±æ—¶é—´æ‰“ç£¨ï¼Œå°½æˆ‘æ‰€èƒ½çš„å†™å‡ºè´¨é‡è¾ƒé«˜ä¸”æ¯”è¾ƒå®¹æ˜“ä¸Šæ‰‹å’Œç†è§£çš„æ–‡ç« ã€‚

![](H:\vue\åå°ç®¡ç†ç³»ç»Ÿ\ã€ä»¥æ¨¡å—åŒ–çš„æ€æƒ³å¼€å‘ä¸­åå°é¡¹ç›®ã€‘\02imgs\aaa.jpg)

## é¡¹ç›®æ„å»ºåçš„é…ç½®

åœ¨é¡¹ç›®åˆå§‹åŒ–å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å†æ¥å¯¹å½“å‰é¡¹ç›®è¿›è¡Œå¼€å‘å‰çš„**å‰æœŸå‡†å¤‡**

### alias

> å½“é¡¹ç›®é€æ¸å˜å¤§ä¹‹åï¼Œæ–‡ä»¶ä¸æ–‡ä»¶ç›´æ¥çš„å¼•ç”¨å…³ç³»ä¼šå¾ˆå¤æ‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨`alias`äº†ã€‚ æœ‰çš„äººå–œæ¬¢alias æŒ‡å‘srcç›®å½•ä¸‹ï¼Œå†ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ‰¾æ–‡ä»¶ï¼Œæˆ‘è¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢å°†å¸¸ç”¨çš„ç›®å½•éƒ½è¿›è¡Œè®¾ç½®

`é…ç½®vue.config.js`
```js
'@': resolve('src'),
'styles': resolve('styles'),
'components': resolve('src/components'),
'api': resolve('src/api'),
'utils': resolve('src/utils'),
'store': resolve('src/store'),
'router': resolve('src/router'),
```

> ä¸Šé¢è¿™äº›å¯ä»¥æ ¹æ®å›¢é˜Ÿå’Œé¡¹ç›®å¤§å°ç¨‹åº¦æ¥è¿›è¡Œé…ç½®ï¼Œä½†æˆ‘è§‰å¾—ç®¡ç†ç³»ç»Ÿåº”è¯¥éƒ½ä¸ä¼šå¤ªå°ï¼Œè‰¯å¥½çš„ä¸€äº›è§„èŒƒå¯¹äºæ—¥å¸¸çš„ç»´æŠ¤å°±æ˜¾å¾—çš„ç‰¹åˆ«é‡è¦äº†

### store/index.js

> æˆ‘ä»¬é€šè¿‡è§£æstoreæ–‡ä»¶ä¸­çš„index.jsæ¥çœ‹çœ‹**webpackæ‰€ä½“ç°å‡ºæ¥çš„å‰ç«¯è‡ªåŠ¨åŒ–**

è¿™é‡Œå¼•ç”¨ä¸€ä¸‹vueå®˜æ–¹çš„ä¾‹å­ï¼Œå°±æ˜¯è¯´å½“æˆ‘ä»¬çŠ¶æ€æ¯”è¾ƒå¤šçš„æ—¶å€™å°±éœ€è¦åˆ†æ¨¡å—æ¥ç®¡ç†æˆ‘ä»¬çš„åº”ç”¨çŠ¶æ€ï¼Œè¯¥é¡¹ç›®ä¹Ÿå°±ç”¨åˆ°äº†modulesæ¥åˆ’åˆ†æ¨¡å—

```js
export user = {
  namespaced: true, // ä½¿ç”¨å‘½åç©ºé—´
  state: () => ({ ... }),
  mutations: { ... },
  actions: { ... },
  getters: { ... }
}

export app = {
  namespaced: true, // ä½¿ç”¨å‘½åç©ºé—´
  state: () => ({ ... }),
  mutations: { ... },
  actions: { ... }
}

import user from './modules/user.js'
import app from './modules/app.js'

const store = new Vuex.Store({
  modules: {
		user,
    app,
  }
})

this.$store.dispatch('user/login') 
this.$store.dispatch('app/toggleSideBar') 
```

### è§£æmodule/index.js

![storeæ–‡ä»¶å¤¹](./02imgs/1.png)

åœ¨å¼€å§‹è§£æä¹‹å‰è¿™é‡Œéœ€è¦è®²ä¸€ä¸ªwebpackæä¾›çš„æ–¹æ³•`require.context`ï¼š è·å–ä¸€ä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡,ä¸»è¦ç”¨æ¥å®ç°è‡ªåŠ¨åŒ–å¯¼å…¥æ¨¡å—ï¼Œå®ƒä¼šéå†æ–‡ä»¶å¤¹ä¸­çš„æŒ‡å®šæ–‡ä»¶,ç„¶åè¿”å›åŒ¹é…çš„æ–‡ä»¶è·¯å¾„, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å®ç°è‡ªåŠ¨å¯¼å…¥ï¼Œä½¿å¾—ä¸éœ€è¦æ¯æ¬¡æ˜¾å¼çš„è°ƒç”¨importå¯¼å…¥æ¨¡å—

`require.context`å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- directory {String} -è¯»å–æ–‡ä»¶çš„è·¯å¾„
- useSubdirectories {Boolean} -æ˜¯å¦éå†æ–‡ä»¶çš„å­ç›®å½•
- regExp {RegExp} -åŒ¹é…æ–‡ä»¶çš„æ­£åˆ™

`require.context`å‡½æ•°æ‰§è¡Œåè¿”å›çš„æ˜¯**ä¸€ä¸ªå‡½æ•°,å¹¶ä¸”è¿™ä¸ªå‡½æ•°æ¥å—3ä¸ªå‚æ•°**

- resolve {Function} -æ¥å—ä¸€ä¸ªå‚æ•°ï¼šä¸ºæ–‡ä»¶å¤¹ä¸‹é¢ç¬¦åˆè·¯å¾„å¯¹åº”çš„æ–‡ä»¶å
- keys {Function} -è¿”å›åŒ¹é…æˆåŠŸæ¨¡å—çš„åå­—ç»„æˆçš„æ•°ç»„
- id {String} -æ‰§è¡Œç¯å¢ƒçš„id,è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç›¸å¯¹äºå·¥ç¨‹çš„ç›¸å¯¹è·¯å¾„&&åŒ¹é…æ­£åˆ™ç»„æˆçš„å­—ç¬¦ä¸²

![](./02imgs/26.png)

> å…¶å®stroe/index.jsä¸­çš„ä»£ç å¹¶ä¸å¤šï¼Œå°±è¿™äºŒåæ¥è¡Œä»£ç å°±å°†`modules`æ–‡ä»¶ä¸­åˆ†å‰²çš„å…­ä¸ªæ¨¡å—éƒ½ç»™å¼•ç”¨äº†è¿›æ¥ï¼Œ

```js
import Vue from 'vue'
import Vuex from 'vuex'
import getters from './getters' // getteræ–‡ä»¶æ˜¯å•ç‹¬æ‰‹åŠ¨å¼•å…¥è¿›æ¥çš„

Vue.use(Vuex)

// ==========================> å…³é”®éƒ¨åˆ†æå–å‡ºæ¥è§£æ

const store = new Vuex.Store({
  modules,
  getters
})

export default store
```

å…³é”®éƒ¨åˆ†æå–å‡ºæ¥è§£æ

```js
// è°ƒç”¨æ–¹æ³•è·å–æ‰€æœ‰å½“å‰æ–‡ä»¶ä¸‹modulesæ–‡ä»¶å¤¹ä¸‹éå†æ‰€æœ‰(.js)æ–‡ä»¶
const modulesFiles = require.context('./modules', true, /\.js$/)

const modules = modulesFiles.keys().reduce((modules, modulePath) => {
  // set './app.js' => 'app' è¿™é‡Œå·²ç»ç»™äº†ä¾‹å­å°±æ˜¯è·å–æ–‡ä»¶åç§°ï¼Œä¸è¿‡æ­£åˆ™å†™çš„ç¨å¾®æœ‰ç‚¹æ¯›ç—…
  /^\.\/(.*)\.\w+$/.test('./.js'); // => true æºç çš„
  /^\.\/(.+)\.\w+$/.test('./.js') // => false ä¿®æ”¹åçš„
  const moduleName = modulePath.replace(/^\.\/(.*)\.\w+$/, '$1')
  const value = modulesFiles(modulePath)
  modules[moduleName] = value.default
  return modules
}, {})

// æœ€åè¿”å›çš„modules
{
  app: {
  	state: () => ({ ... }),
  	mutations: { ... },
  	actions: { ... }                 
  },
  user: {
  	state: () => ({ ... }),
  	mutations: { ... },
  	actions: { ... }                 
  },
	...                      
}
```

> æ³¨æ„âš ï¼š`require`å‡½æ•°ä¸­å‚æ•°æ— æ³•ä½¿ç”¨å˜é‡çš„é—®é¢˜

Badï¼šä»¥ä¸‹å†™æ³•éƒ½ä¼šæŠ¥é”™

```js
let imgUrl = 'å›¾ç‰‡è·¯å¾„'
<img src={require(imgUrl)}></img>
```

```js
function importAll (targetPath, isDeepDirectory, execPathReg) {
  require.context(targetPath, isDeepDirectory, execPathReg)
}
importAll('./components/common', true, /\.vue$/)

```

Good: ä¸‹é¢è¿™ç§å†™æ³•ä¸ä¼šæŠ¥é”™

```js
let imgUrl = require('å›¾ç‰‡è·¯å¾„')
<img src={imgUrl}></img>
```

```js
export function importAll(module)  {
  module.keys().forEach( path => {
		console.log(path)
	})
}

import { importAll } from './importAll.js'
importAll(require.context('./components/common', true, /\.vue$/))
```

### Register Global Components

> å€Ÿç”¨ä¸Šé¢çš„æ€è·¯æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡`require.context`è¿™ä¸ªæ–¹æ³•æ¥å…¨å±€æ³¨å†Œæˆ‘ä»¬ä¹‹å‰å°è£…çš„é€šç”¨å…¨å±€ç»„ä»¶

![é¡¹ç›®ä¸­å¸¸ç”¨çš„ç»„ä»¶](./02imgs/17.png)

`main.js`

```js
// global components
const r = require.context('./components/common', true, /\.vue$/)
r.keys().forEach(path => {
  const filePath = path.substr(2)
  const module = require('./components/common/' + filePath)
  Vue.component(module.default.name, module.default)
})
```

æˆ‘ä»¬consooe.log(module)çœ‹ä¸‹

![ç»„ä»¶å®ä¾‹](./02imgs/18.png)

**æ•ˆæœå›¾ğŸ’—**

å…ˆæ‰¾ä¸ªé¡µé¢ç›´æ¥copyä½¿ç”¨

```js
<div class="plan">
  <DynamicForm
    ref="pageForm"
    v-model="formModel"
    label-width="130px"
    :form-config="baseFormConfig"
    :show-btn="false"
  />
</div>
```

![ç›´æ¥ä½¿ç”¨å…¨å±€æ³¨å†Œçš„ç»„ä»¶](./02imgs/19.gif)

> è¿™é‡Œéœ€è¦æ³¨æ„âš ï¼šå…¨å±€æ³¨å†Œçš„ç»„ä»¶å¿…é¡»æ˜¯åœ¨root Vue å‰é¢æ³¨å†Œï¼š[Vueæ–‡æ¡£:ç»„ä»¶æ³¨å†Œ](https://cn.vuejs.org/v2/guide/components-registration.html)

![](./02imgs/27.png)

### router/index.js

> ä¸€ä¸ªåºå¤§çš„ç®¡ç†ç³»ç»Ÿä¸€å®šä¼šæœ‰å¾ˆå¤šé¡µé¢ï¼Œå•é router/index.jså¼•å…¥è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªæ¨¡å—è¿›è¡Œåˆ’åˆ†æˆç‹¬ç«‹æ–‡ä»¶ï¼Œåœ¨æ—¥åç»´æŠ¤çš„æ—¶å€™å¯ä»¥çœ‹åˆ°é¡µé¢å°±èƒ½çŸ¥é“å½“å‰è·¯ç”±åœ¨å“ªä¸ªæ–‡ä»¶ä¸‹ï¼Œå¦‚æœå½“å‰æ¨¡å—éœ€è¦æ·»åŠ é¡µé¢ä¹Ÿä¸éœ€è¦å»index.jsæ–‡ä»¶ä¸­æ‰¾ã€‚

![åºå¤§çš„é¡¹ç›®](./02imgs/2.gif)

**æˆ‘ä»¬çš„æ¨¡å—**

![](./02imgs/3.png)

![](./02imgs/4.png)

`router/index.js`

```js
/* é¡µé¢æ¡†æ¶ */
import Layout from '@/layout'

/* errorPageæ¨¡å— */
import dashboard from './dashboard'

/* loginæ¨¡å— */
import login from './login'

/* Aæ¨¡å— */
import testA from './testA'
/* Bæ¨¡å— */
import testB from './testB'
/* Cæ¨¡å— */
import testC from './testC'
/* Dæ¨¡å— */
import testD from './testD'
/* Eæ¨¡å— */
import testE from './testE'
/* Fæ¨¡å— */
import testF from './testF'
/* Gæ¨¡å— */
import testG from './testG'

export const asyncRoutes = [
  ...testA,
  ...testB,
  ...testC,
  ...testD,
  ...testE,
  ...testF,
  ...testG,
  // 404 page must be placed at the end !!!
  { path: '*', redirect: '/404', hidden: true }
]
```

åƒä¸Šé¢è¿™æ ·æ¨¡å—åŒ–è§„èŒƒï¼Œä¸ç®¡é¡¹ç›®æ€ä¹ˆåºå¤§ç»´æŠ¤èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚

### styles/variable.scss

> å¯¹äºå…¨å±€æ ·å¼æˆ‘ä»¬å¯ä»¥åšå¯é…ç½®åŒ–çš„ï¼Œåƒä¾§è¾¹æ é…è‰²è¿™ç§ã€‚

`variable.scss`

```scss
/ sidebar
$menuText:#bfcbd9;
$menuActiveText:#fff;
$subMenuActiveText:#f4f4f5; 

$menuBg:#008B8D;
$menuHover:rgba(102, 197, 199, .68);

$subMenuBg:#00787A;
$subMenuHover: rgba(102, 197, 199, .68);

:export {
  menuText: $menuText;
  menuActiveText: $menuActiveText;
  subMenuActiveText: $subMenuActiveText;
  menuBg: $menuBg;
  menuHover: $menuHover;
  subMenuBg: $subMenuBg;
  subMenuHover: $subMenuHover;
  sideBarWidth: $sideBarWidth;
}

```

ä½¿ç”¨

```js
<template>
  <div :class="{'has-logo':showLogo}">
      <el-menu
        :default-active="activeMenu"
        :collapse="isCollapse"
        :background-color="variables.menuBg"
        :text-color="variables.menuText"
        :unique-opened="false"
        :active-text-color="variables.menuActiveText"
        :collapse-transition="false"
        mode="vertical"
      >
      </el-menu>
  </div>
</template>


<script>
// ä»¥jsçš„å½¢å¼å¯¼å…¥æ ·å¼æ–‡ä»¶
import variables from '@/styles/variables.scss'
<script>
```

- æºç åœ°å€ğŸŒŸï¼šhttps://github.com/it-beige/books.git
- å†å²ç‰ˆæœ¬â­ï¼šec0476d48e9bf6440bae3606d641cabf14c563ef

### styles/element-variables

>  å…¨å±€é…ç½®æŒ‰é’®çš„é…è‰²

`element-variables`

```js
@import './variables';

/* theme color */
$--color-primary: $panGreen;
$--color-success: $success;
$--color-warning: $warning;
$--color-danger: $danger;
// $--col

// é…ç½®ä¸»é¢˜è‰²
:export {
  theme: $--color-primary;
}

```

```js
<el-button type="primary">æŒ‰é’®</el-button>
```

æ•ˆæœå›¾ğŸ’—

![](./02imgs/12.png)

### utils/tip

> å¯¹æç¤ºæ¡†è¿›è¡ŒåŒ…è£…ï¼Œè¿™é‡Œæœ€ä¸»è¦çš„æ˜¯å¯¹erroræç¤ºçš„å°è£…å¤„ç†

`tip.js`

```js
import { Message } from 'element-ui'
import { isObject } from '@/utils/index'
import Vue from 'vue'

function Tip(type, value, options = {}) {
  if (!type) {
    throw new Error('type must pass!')
  }
  const {
    duration = 5000,
    showClose = false,
  } = options

  const message = isObject(value) && (value.msg || value.message) || value || 'æ“ä½œå¤±è´¥'
  Message.closeAll()
  Message({
    message: message,
    type: type,
    showClose: showClose,
    duration: duration
  })
}

export function showSuccess(msg, ...options) {
  // å¦‚æœä¼ é€’äº†é…ç½®é¡¹å®ç”¨è‡ªå®šä¹‰çš„é…ç½®é¡¹
  Tip('success', msg, { ...options })
}
export function showError(msg, ...options) {
  Tip('error', msg, { ...options })
  throw new Error(msg)
}
export function showWarning(msg, ...options) {
  Tip('warning', msg, { ...options })
}


Vue.prototype.$showSuccess = showSuccess
Vue.prototype.$showError = showError
Vue.prototype.$showWarning = showWarning
```

`Message.closeAll()`: è°ƒç”¨å‰å…³é—­ä¹‹å‰çš„å®ä¾‹


æ•ˆæœå›¾ğŸ’—

![ä½¿ç”¨å‰](./02imgs/13.gif)
![ä½¿ç”¨å](./02imgs/14.gif)

æœ€ä¸»è¦çš„è¿˜æ˜¯å¯¹errorçš„å¤„ç†ï¼Œç›¸ä¿¡å¤§å®¶è‚¯å®šé‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šå½“æˆ‘ä»¬ä½¿ç”¨forEachå»éå†æ•°æ®å½“æ²¡æœ‰è¾¾åˆ°æ¡ä»¶çš„æ—¶å€™æƒ³é˜»æ–­ç¨‹åºçš„è¿è¡Œå¹¶æŠ›å‡ºé”™è¯¯æç¤ºç»™ç”¨æˆ·ï¼Œè¿™ä¸ªæ—¶å€™å°±å‘ç°returnçš„æ˜¯forEachçš„å›è°ƒï¼Œæ‰§è¡Œæ–¹æ³•å¹¶æ²¡æœ‰returnã€‚(**æ³¨âš ï¼šè¿™é‡Œè¦è®¨è®ºå¹¶ä¸æ˜¯ç”¨Arrayæ–¹æ³•èƒ½ä»£æ›¿çš„é—®é¢˜: å¦‚ findã€findIndexã€someã€every**)

```js
handleClick() {
  /**
    è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œå®é™…åº”ç”¨ä¸­è‚¯å®šæ¡ä»¶æ¯”è¿™ä¸ªå¤æ‚
   */
  let arr = [
    {index: 1},
    {index: 2},
    {index: 3}
  ]; 
  arr.forEach(i =>{
    // çœŸå®åœºæ™¯ä¸­çš„è‚¯å®šä¸æ˜¯å¯¹è±¡indexçš„æ¡ä»¶
    if (i.index === 2) {
      console.log('æç¤ºç”¨æˆ·ï¼Œæ•´ä¸ªæ–¹æ³•ä¸åœ¨æ‰§è¡Œï¼æŒ‡çš„æ˜¯ => handleClick')
    }
    // æ‰§è¡Œä¸€å¤§å †é€»è¾‘....
    
  })
  // ä¸€å¤§å¨ä¸šåŠ¡å¤„ç†
      
}
```

æˆ‘ä»¬ä¸€èˆ¬ä¸¤ç§åšæ³•ï¼š

```js
handleClick() {
  let flag = false;
	arr.forEach(i =>{
 	 	// çœŸå®åœºæ™¯ä¸­çš„è‚¯å®šä¸æ˜¯å¯¹è±¡indexçš„æ¡ä»¶
 	 	if (i.index === 2) {
    	console.log('æç¤ºç”¨æˆ·ï¼Œæ•´ä¸ªæ–¹æ³•ä¸åœ¨æ‰§è¡Œï¼æŒ‡çš„æ˜¯ => handleClick')
    	flag = true;
 	 	}
 	 	if (flag === true) return;
  		// æ‰§è¡Œä¸€å¤§å †é€»è¾‘....
		})
	if (flag === true) return;
}
```

æ›´ç›´æ¥ä¸€ç‚¹çš„åšæ³•

```js
handleClick() {
	try {
  	arr.forEach(i =>{
    	if (i.index === 2) {
      	throw new Error('æç¤ºç”¨æˆ·')
    	}
  	})
  } catch(e) {
  	this.$message.error(e.message)
  	console.error(e)
  	return 
	}
	console.log(11111); // =>ä¸‹é¢çš„ç¨‹åºä¸åœ¨æ‰§è¡Œ
}
```

æˆ‘è‡ªå·±è¿˜ç ”ç©¶å‡ºæ¥ä¸€ç§æ›´éªšçš„åšæ³•

```js
export function showError(msg, ...options) {
  // å¦‚æœä¼ é€’äº†é…ç½®é¡¹å®ç”¨è‡ªå®šä¹‰çš„é…ç½®é¡¹
  Tip('error', msg, { ...options })
  return throw new Error(msg)
}
```

ç„¶ååœ¨mian.jsä¸­ä½¿ç”¨`Vue.config.errorHandler`å¯¹å…¨å±€çš„é”™è¯¯è¿›è¡Œå¼‚å¸¸ç›‘æ§

```js
// å¯¹å…¨å±€çš„é”™è¯¯è¿›è¡Œå¼‚å¸¸ç›‘æ§
Vue.config.errorHandler = function (err, vm, info) {
	let { 
	    message, // å¼‚å¸¸ä¿¡æ¯
	    name, // å¼‚å¸¸åç§°
	    script,  // å¼‚å¸¸è„šæœ¬url
	    line,  // å¼‚å¸¸è¡Œå·
	    column,  // å¼‚å¸¸åˆ—å·
	    stack  // å¼‚å¸¸å †æ ˆä¿¡æ¯
	} = err;
	
	// vmä¸ºæŠ›å‡ºå¼‚å¸¸çš„ Vue å®ä¾‹
	// infoä¸º Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­
  console.error(message);
}
```

æ•ˆæœå›¾ğŸ’—

![](./02imgs/15.gif)

### vuex-persist

Vuex è§£å†³äº†å¤šè§†å›¾ä¹‹é—´çš„æ•°æ®å…±äº«é—®é¢˜ï¼Œä½†æ˜¯Vuex çš„çŠ¶æ€å­˜å‚¨å¹¶ä¸èƒ½æŒä¹…åŒ–ï¼Œå½“ä½ å­˜å‚¨åœ¨ Vuex ä¸­çš„ store é‡Œçš„æ•°æ®ï¼Œåªè¦ä¸€åˆ·æ–°é¡µé¢ï¼Œæ•°æ®å°±ä¸¢å¤±äº†ã€‚å‰é¢æˆ‘ä»¬å°è£…çš„Storageå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬å†äº†è§£ä¸€ä¸ªè§£å†³vuexåˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±é—®é¢˜

> [vuex-persist](https://github.com/championswimmer/vuex-persist) æ’ä»¶ï¼Œå®ƒå°±æ˜¯ä¸º Vuex æŒä¹…åŒ–å­˜å‚¨è€Œç”Ÿçš„ä¸€ä¸ªæ’ä»¶ã€‚ä¸éœ€è¦ä½ æ‰‹åŠ¨å­˜å– storage ï¼Œè€Œæ˜¯ç›´æ¥å°†çŠ¶æ€ä¿å­˜è‡³ cookie æˆ–è€… Storage ä¸­ã€‚

`install`

```js
npm install vuex-persist --save
```

**vuex-persist çš„è¯¦ç»†å±æ€§ï¼š**

| å±æ€§         | ç±»å‹                               | æè¿°                                                         |
| ------------ | ---------------------------------- | ------------------------------------------------------------ |
| key          | string                             | å°†çŠ¶æ€å­˜å‚¨åœ¨å­˜å‚¨ä¸­çš„é”®ã€‚é»˜è®¤: 'vuex'                         |
| storage      | Storage (Web API)                  | å¯ä¼ localStorage, sessionStorage, localforage æˆ–è€…ä½ è‡ªå®šä¹‰çš„å­˜å‚¨å¯¹è±¡. æ¥å£å¿…é¡»è¦æœ‰getå’Œset.  **é»˜è®¤æ˜¯: window.localStorage** |
| saveState    | function (key, state[, storage])   | å¦‚æœä¸ä½¿ç”¨å­˜å‚¨ï¼Œè¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°å°†ä¿å­˜çŠ¶æ€ä¿å­˜ä¸ºæŒä¹…æ€§ã€‚       |
| restoreState | function (key[, storage]) => state | å¦‚æœä¸ä½¿ç”¨å­˜å‚¨ï¼Œè¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°å¤„ç†ä»å­˜å‚¨ä¸­æ£€ç´¢çŠ¶æ€           |
| reducer      | function (state) => object         | å°†çŠ¶æ€å‡å°‘åˆ°åªéœ€è¦ä¿å­˜çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¿å­˜æ•´ä¸ªçŠ¶æ€ã€‚       |
| filter       | function (mutation) => boolean     | çªå˜ç­›é€‰ã€‚çœ‹mutation.typeå¹¶è¿”å›trueï¼Œåªæœ‰é‚£äº›ä½ æƒ³åšæŒå†™è¢«è§¦å‘ã€‚æ‰€æœ‰çªå˜çš„é»˜è®¤è¿”å›å€¼ä¸ºtrueã€‚ |
| modules      | string[]                           | è¦æŒä¹…åŒ–çš„æ¨¡å—åˆ—è¡¨ã€‚                                         |

`store/index.js`

> å…ˆç®€å•ä½¿ç”¨ä¸‹çœ‹

```js
import VuexPersistence from 'vuex-persist'

// åˆ›å»ºå¯¹è±¡ï¼Œå€ŸåŠ©æµè§ˆå™¨ç¼“å­˜ï¼Œå­˜å…¥localStorage
const vuexLocal = new VuexPersistence()

// ä½¿ç”¨è¯¥æ’ä»¶
const store = new Vuex.Store({
  modules,
  getters,
  plugins: [vuexLocal.plugin]
})
```

è¿™ç§ç”¨æ³•ç›´æ¥å°†æ‰€æœ‰moduleä¸­çš„stateéƒ½ç¼“å­˜ä¸‹æ¥äº†ã€‚

![](./02imgs/28.png)

**saveStateé…ç½®é¡¹**

> å°†å‡½æ•°ä¿å­˜ä¸ºæŒä¹…åŒ–ï¼Œæ¯æ¬¡é¡µé¢åˆ·æ–°éƒ½ä¼šæ‰§è¡Œä¸‹è¯¥å‡½æ•°

```js
const vuexLocal = new VuexPersistence({
  key: 'myVuex', // defalut: vuex
  storage: window.sessionStorage, // å¯é€‰ï¼ŒlocalStorage/indexDB defalut: localStorage
  // å°†å‡½æ•°ä¿å­˜ä¸ºæŒä¹…åŒ–ï¼Œæ¯æ¬¡é¡µé¢åˆ·æ–°éƒ½ä¼šæ‰§è¡Œä¸‹è¯¥å‡½æ•°
  saveState: (key, state, storage) => {
    console.log(key, state, storage)
  }
})
```

![](./02imgs/29.png)

**restoreStateé…ç½®é¡¹**

> å°†Storageä¸­çš„æ•°æ®è¿›è¡Œç­›é€‰æ·»åŠ åˆ°state

```js
const vuexLocal = new VuexPersistence({
  key: 'myVuex', // defalut: vuex
  storage: window.sessionStorage, // å¯é€‰ï¼ŒlocalStorage/indexDB defalut: localStorage
  // Storageä¸­çš„æ•°æ®è¿›è¡Œç­›é€‰æ·»åŠ åˆ°state
  restoreState: (key, storage) => {
    // console.log(key, storage)
    return { [key]: storage }
  },
})
```

![](./02imgs/31.png)

**reduceré…ç½®é¡¹**

> é»˜è®¤æƒ…å†µä¸‹ä¿å­˜æ•´ä¸ªçŠ¶æ€, è¯¥æ–¹æ³•å¯ä»¥ç­›é€‰stateæ ¹æ®éœ€æ±‚å‡å°‘åˆ°åªéœ€è¦ä¿å­˜çš„çŠ¶æ€ 

```js
const vuexLocal = new VuexPersistence({
  key: 'myVuex', // defalut: vuex
  storage: window.sessionStorage, // å¯é€‰ï¼ŒlocalStorage/indexDB defalut: localStorage
  // é»˜è®¤æƒ…å†µä¸‹ä¿å­˜æ•´ä¸ªçŠ¶æ€, è¯¥æ–¹æ³•å¯ä»¥ç­›é€‰stateæ ¹æ®éœ€æ±‚å‡å°‘åˆ°åªéœ€è¦ä¿å­˜çš„çŠ¶æ€ ã€‚
  reducer: (state) => {
    const userState = Object.entries(state).find(s => s[0] === 'user')
    console.log(userState)
    return { [userState[0]]: userState[1] } // è¿™ä¸ªå°±æ˜¯å­˜å…¥Storageçš„å€¼
  },
  
   // => modules: ['user'], // å’Œreducerä¸€æ ·çš„æ•ˆæœ
})
```

![](./02imgs/32.png)

## ç™»å½•æ¨¡å—

> ä¸‹é¢æˆ‘ä»¬è®²ä¸‹å•ç‚¹ç™»å½•çš„æµç¨‹ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚

æµç¨‹å›¾ğŸ’—

![ç™»å½•æµç¨‹](./02imgs/5.png)

å®ç°çš„åŠŸèƒ½

> ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç‚¹å‡»ç™»å½•è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç™»è¿›æˆ‘ä»¬çš„å¹³å°ï¼Œæˆ‘ä»¬åœ¨å¹³å°å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é€€å‡ºç™»å½•ï¼Œå›åˆ°ç™»å½•é¡µé¢ç™»å½•æµç¨‹

å¤§æ¦‚æµç¨‹ï¼š

- ç”¨æˆ·è¾“å…¥ä¿¡æ¯ç‚¹å‡»ç™»å½•çš„æ—¶å€™ä¼šè°ƒç”¨ç™»å½•æ¥å£å°†ç”¨æˆ·åå’Œå¯†ç ä¼ åˆ°æˆ‘ä»¬çš„åç«¯
- åç«¯é€šè¿‡æ•°æ®åº“ä¸­ä¸éªŒè¯æˆ‘ä»¬çš„ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®éªŒè¯æ­£ç¡®ä¹‹åä¼šé€šè¿‡`jwt`ç”Ÿæˆä¸€ä¸ª`token`ä»¤ç‰Œ(é‡Œé¢åŒ…å«ç”¨æˆ·çš„ä¿¡æ¯)
- å‰ç«¯æ”¶åˆ°è¿™ä¸ªtokenä¹‹åå°±ä¼šæŠŠå®ƒä¿å­˜åœ¨æœ¬åœ°(cookie)ï¼Œç„¶åé€šè¿‡axiosè¯·æ±‚æ‹¦æˆªå™¨åœ¨æ¯æ¬¡å‘é€è¯·æ±‚å‰éƒ½å°†tokené™„å¸¦è‡³headerå¤´ä¸­ï¼Œä¹‹åå‰ç«¯ä¼šå†æ¬¡å‘é€ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œåç«¯é€šè¿‡tokenè¿›è¡Œæ ¡éªŒæ¥æ£€æŸ¥ä¿¡æ¯æ˜¯å¦ä¸€è‡´ï¼Œé€šè¿‡ä¹‹åå°†æ•°æ®è¿”å›ç»™å‰ç«¯ã€‚
- å‰ç«¯å¯ä»¥é€šè¿‡è¿”å›æ•°æ®ä¸­çš„è§’è‰²ä¿¡æ¯æ¥è¿›è¡Œç”¨æˆ·æƒé™æ ¡éªŒï¼ŒåŠ¨æ€æ·»åŠ è·¯ç”±æ¥ç”Ÿæˆä¾§è¾¹æ ã€‚

> æ‰€ä»¥è¿™ä¸ªåå°ç³»ç»Ÿçš„æ ¹æ®æƒé™åŠ¨æ€åŠ è½½è·¯ç”±çš„æ–¹å¼æ˜¯å‰ç«¯å®ç°çš„ï¼Œåç«¯åªæ˜¯æä¾›äº†æƒé™çš„è§’è‰²ã€‚

è¿™é‡Œè®¾è®¡åˆ°äº†ä¸‰ä¸ªæ ¸å¿ƒç‚¹

- é€šè¿‡è·¯ç”±å®ˆå«æ¥æ ¹æ®tokenåŠrolesä¸­çš„è§’è‰²ä¿¡æ¯æ¥åšè·¯ç”±è·³è½¬å¤„ç†
- æ ¹æ®è·¯ç”±è¡¨ä¸­é…ç½®çš„`roles`æ¥åŒ¹é…å½“å‰ç”¨æˆ·è§’è‰²èƒ½è¿›å…¥çš„é¡µé¢ç„¶åé€šè¿‡`router.addRoutes`æ–¹å¼æ¥å¼‚æ­¥æŒ‚è½½è·¯ç”±
- é€šè¿‡ç¼–å†™`redirect.vue`ç»„ä»¶çš„æ–¹å¼æ¥è§£å†³routerä¸­åŒæ ·`URL` ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“çš„é—®é¢˜

### é€šè¿‡tokenéªŒè¯åšè·¯ç”±çš„è·³è½¬å¤„ç†âš¡

ä¸­åå°å¸¸è§è·¯ç”±çš„è·³è½¬å¦‚ä¸‹ï¼š

- å·²è·å– Tokenï¼š
  - è®¿é—® `/login`ï¼šé‡å®šå‘åˆ° `/`
  - è®¿é—® `/login?redirect=/xxx`ï¼šé‡å®šå‘åˆ° `/xxx`
  - è®¿é—® `/login` ä»¥å¤–çš„è·¯ç”±ï¼šç›´æ¥è®¿é—® `/xxx`
- æœªè·å– Tokenï¼š
  - è®¿é—® `/login`ï¼šç›´æ¥è®¿é—® `/login`
  - è®¿é—® `/login` ä»¥å¤–çš„è·¯ç”±ï¼šå¦‚è®¿é—® `/dashboard`ï¼Œå®é™…è®¿é—®è·¯å¾„ä¸º `/login?redirect=%2Fdashboard`ï¼Œç™»å½•åä¼šç›´æ¥é‡å®šå‘ `/dashboard`

> ä¸ºäº†æ›´å¥½çš„è®©å¤§å®¶ç†è§£ï¼Œæˆ‘é€šè¿‡è°ƒå¼çš„æ–¹å¼æ¥å‘ˆç°ï¼Œå› ä¸ºå¸§æ•°é™åˆ¶çš„å…³ç³»æ‰€ä»¥ä¸­é—´ä¸€äº›ä¸é‡è¦çš„ç‚¹æˆ‘å°±ç›´æ¥è·³è¿‡äº†ã€‚è‚¯å®šæ˜¯ä¸èƒ½æŠŠæ‰€æœ‰ç‚¹çš„éƒ½å±•ç°å‡ºæ¥ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºè®®å¤§å®¶è‡ªå·±ä¹ŸåŠ¨æ‰‹å»è°ƒå¼ã€‚

#### éªŒè¯æ²¡æœ‰tokenè®¿é—®/loginçš„æƒ…å†µğŸ’—

![æ²¡æœ‰tokenè®¿é—®login](./02imgs/6.gif)

#### éªŒè¯æ²¡æœ‰tokenè®¿é—®å…¶ä»–ç»„ä»¶çš„æƒ…å†µğŸ’—

> è¿›å…¥ä¸åœ¨ç™½åå•ä¸­çš„elseé€»è¾‘ï¼Œç›´æ¥é‡å®šå‘åˆ°loginå°†è¦å»çš„è·¯ç”±å½“åš`redirect`çš„å‚æ•°

![æ²¡æœ‰tokenè®¿é—®å…¶ä»–ç»„ä»¶](./02imgs/7.png)

#### è°ƒç”¨ç™»å½•æ¥å£æ¥è®¿é—®è·Ÿè·¯ç”±çš„æƒ…å†µğŸ’—

![](./imgs/8.gif)

è¿™é‡Œå¯ä»¥é‡ç‚¹åˆ†æä¸‹æ ¹æ®è§’è‰²ä¿¡æ¯ç­›é€‰è·¯ç”±è¡¨çš„é€»è¾‘

```js
const accessRoutes = await store.dispatch('permission/generateRoutes', roles)
```

`store/modules/permission.js`

> é€šè¿‡store.dispatchè§¦å‘actionsæ–¹æ³•ï¼Œè¿™é‡Œå› ä¸ºç”¨äº†modulesæ¨¡å—åˆ†æ ¼å¹¶ä¸”`namespaced: true`æ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šå‰ç¼€ã€‚

```js
const actions = {
  // actionsæ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯é»˜è®¤ä¼ é€’è¿›åˆ°çš„storeå®ä¾‹å¯¹è±¡ï¼Œè§£æ„å‡ºæ¥commitç”¨æ¥æ‰‹åŠ¨è§¦å‘mutationsä¸­çš„æ–¹æ³•
  // ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å½“å‰çš„ç”¨æˆ·è§’è‰² => å‡è®¾å½“å‰roles = 'Beige'
  generateRoutes({ commit }, roles) { 
	// actionsä¸­å…è®¸æˆ‘ä»¬æ‰§è¡Œå¼‚æ­¥æ“ä½œ
    return new Promise(resolve => {
      let accessedRoutes
      if (roles.includes('admin')) { // adminè§’è‰²ä¸éœ€è¦åšæƒé™è¿‡æ»¤ï¼Œæ‰€æœ‰çš„å¼‚æ­¥è·¯ç”±éƒ½å¯ä»¥çœ‹
        accessedRoutes = asyncRoutes || [] // => asyncRoutes = routeræ–‡ä»¶ä¸­å®šä¹‰çš„å¼‚æ­¥è·¯ç”±è¡¨
      } else {
			 	// å…¶ä»–è§’è‰²éœ€è¦è¿›è¡Œè§’è‰²åŒ¹é…çœ‹è·¯ç”±è¡¨ä¸­æ˜¯å¦æœ‰è·¯ç”±é…ç½®å½“å‰è§’è‰²å¯ä»¥çœ‹
        accessedRoutes = filterAsyncRoutes(asyncRoutes, roles) 
      }
      commit('SET_ROUTES', accessedRoutes)
      resolve(accessedRoutes)
    })
  }
}
```

`filterAsyncRoutesæ–¹æ³•`

```js
// routes æ‰€æœ‰çš„å¼‚æ­¥è·¯ç”±è¡¨
// roles å½“å‰è§’è‰² 'Beige'
export function filterAsyncRoutes(routes, roles) {
  const res = []

  routes.forEach(route => {
    const tmp = { ...route }
    if (hasPermission(roles, tmp)) { // è°ƒç”¨hasPermissionæ¥è¿›è¡Œè§’è‰²é‰´æƒ
      if (tmp.children) {  
        // å¦‚æœæœ‰å­ç»„ä»¶é€’å½’æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œç­›é€‰ï¼Œå¦‚æœå­ç»„ä»¶éƒ½æ²¡ç¬¦åˆçš„å“ªå°±ä¸èƒ½æŒ‚è½½äº†
        // æ¯”å¦‚ä¸‹é¢ï¼ŒBç»„ä»¶å°±ä¸èƒ½æ˜¾ç¤ºåœ¨ä¾§è¾¹æ ä¸­äº†
			{
        component: 'A', 
        meta: meta: {roles: ['Beige']}
        children: [
          {component: 'B', meta: {roles: ['editor']}}
        ]
        tmp.children = filterAsyncRoutes(tmp.children, roles)
      }
      res.push(tmp)
    }
  })
  return res
}
```

`hasPermissionæ–¹æ³•`

```js
// roles å½“å‰è§’è‰² 'Beige'
// route å¼‚æ­¥è·¯ç”±è¡¨
// åæ§½ä¸€ä¸‹è¿™é‡Œå°±æœ‰ç‚¹ä¸è®²æ­¦å¾·äº†ï¼Œåˆšè¿˜æ˜¯å…ˆè·¯ç”±è¡¨å†è§’è‰²ï¼Œæ€ä¹ˆå°±æ¢äº†ä¸ªä½ç½®
function hasPermission(roles, route) {
  if (route.meta && route.meta.roles) {
	  ['admin', 'Beige', 'editor'].inclues('Beige') => å›åˆ°ä¸Šé¢çš„æ–¹æ³•
    return roles.some(role => route.meta.roles.includes(role)) 
  } else {  // å¦‚æœæ²¡æœ‰é…ç½®å°±é»˜è®¤å…è®¸æ‰€æœ‰è§’è‰²è®¿é—®
    return true
  }
}
```

#### redirect.vue

> æ¥ç€è§£æä¸‹`redirect.vue`ç»„ä»¶å®ç°çš„åŠŸèƒ½

1. è®°å½•é‡å®šå‘è‡ªå·±çš„ç»„ä»¶ï¼Œåœ¨å¾—åˆ°æƒé™ä¹‹åæ–¹ä¾¿è·³è½¬
2. ç”¨æ¥è§£å†³è®¿é—®åŒæ ·çš„urlå¯¼è‡´é¡µé¢ä¸é‡æ–°æ¸²æŸ“çš„é—®é¢˜

**é—®é¢˜ä¸€**

![è®°å½•è·³è½¬è·¯ç”±](./02imgs/9.gif)

**é—®é¢˜äºŒ**

![ç›¸åŒè·¯ç”±ä¸‹çš„é¡µé¢æ¸²æŸ“é—®é¢˜](./02imgs/10.gif)

å†…éƒ¨å®ç°çš„æ–¹å¼å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡`redirect.vue`ç»„ä»¶åšä¸­è½¬æ¥è·³åˆ°æƒ³å»çš„è·¯ç”±åŒæ—¶ä¹Ÿè¾¾åˆ°äº†ç»„ä»¶é‡æ–°æ„å»ºçš„ç›®çš„

```js
<script>
export default {
  created() {
		// ä»è·¯ç”±å®ä¾‹å¯¹è±¡ä¸­è·å–paramsä¸­çš„path, queryï¼šä¼ é€’çš„å‚æ•°
    const { params, query } = this.$route
    const { path } = params
    // ç›´æ¥è·³è½¬åˆ°æƒ³å»çš„pathå¹¶ä¸”å°†å‚æ•°ä¼ é€’è¿›å»
    this.$router.replace({ path: '/' + path, query })
  },
  render: function(h) { 
    return h() // avoid warning message
  }
}
</script>
```

![æµç¨‹å›¾](./02imgs/11.jpg)

#### æ€»ç»“

##### å…³äºè·¯ç”±å¤„ç†

- vue-element-admin å¯¹æ‰€æœ‰è®¿é—®çš„è·¯ç”±è¿›è¡Œæ‹¦æˆªï¼›
- è®¿é—®è·¯ç”±æ—¶ä¼šä» Cookie ä¸­è·å– Tokenï¼Œåˆ¤æ–­ Token æ˜¯å¦å­˜åœ¨ï¼š
  - å¦‚æœ Token å­˜åœ¨ï¼Œå°†æ ¹æ®ç”¨æˆ·è§’è‰²ç”ŸæˆåŠ¨æ€è·¯ç”±ï¼Œç„¶åè®¿é—®è·¯ç”±ï¼Œç”Ÿæˆå¯¹åº”çš„é¡µé¢ç»„ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå³ç”¨æˆ·è®¿é—® `/login` æ—¶ä¼šé‡å®šå‘è‡³ `/` è·¯ç”±ï¼›
  - å¦‚æœ Token ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ¤æ–­è·¯ç”±æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨ç™½åå•ä¸­å°†ç›´æ¥è®¿é—®ï¼Œå¦åˆ™è¯´æ˜è¯¥è·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œæ­¤æ—¶ä¼šå°†è·¯ç”±ç”Ÿæˆä¸€ä¸ª redirect å‚æ•°ä¼ å…¥ login ç»„ä»¶ï¼Œå®é™…è®¿é—®çš„è·¯ç”±ä¸ºï¼š`/login?redirect=/xxx`ã€‚

#####  å…³äºåŠ¨æ€è·¯ç”±å’Œæƒé™æ ¡éªŒ

- vue-element-admin å°†è·¯ç”±åˆ†ä¸ºï¼šconstantRoutes å’Œ asyncRoutes
- ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ—¶ï¼Œä¼šåŠ¨æ€ç”Ÿæˆè·¯ç”±ï¼Œå…¶ä¸­ constantRoutes å¿…ç„¶åŒ…å«ï¼ŒasyncRoutes ä¼šè¿›è¡Œè¿‡æ»¤ï¼›
- asyncRoutes è¿‡æ»¤çš„é€»è¾‘æ˜¯çœ‹è·¯ç”±ä¸‹æ˜¯å¦åŒ…å« meta å’Œ meta.roles å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªé€šç”¨è·¯ç”±ï¼Œä¸éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒï¼›å¦‚æœåŒ…å« roles å±æ€§åˆ™ä¼šåˆ¤æ–­ç”¨æˆ·çš„è§’è‰²æ˜¯å¦å‘½ä¸­è·¯ç”±ä¸­çš„ä»»æ„ä¸€ä¸ªæƒé™ï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™å°†è·¯ç”±ä¿å­˜ä¸‹æ¥ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™ç›´æ¥å°†è¯¥è·¯ç”±èˆå¼ƒï¼›
- asyncRoutes å¤„ç†å®Œæ¯•åï¼Œä¼šå’Œ constantRoutes åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„è·¯ç”±å¯¹è±¡ï¼Œå¹¶ä¿å­˜åˆ° vuex çš„ permission/routes ä¸­ï¼›
- ç”¨æˆ·ç™»å½•ç³»ç»Ÿåï¼Œä¾§è¾¹æ ä¼šä» vuex ä¸­è·å– `state.permission.routes`ï¼Œæ ¹æ®è¯¥è·¯ç”±åŠ¨æ€æ¸²æŸ“ç”¨æˆ·èœå•ã€‚

### sidebar/sidebar-item ä¸­çš„å€¼å¾—å­¦ä¹ çš„ç‚¹âš¡

> å…¶å®åœ¨`vue-element-admin`åŠ¨æ€ç”Ÿæˆè·¯ç”±æ¥å¯¹åº”ç”Ÿäº§ä¾§è¾¹æ çš„å®ç°ä¸­ï¼Œ`sidebar`/`sidebar-item `çš„å®ç°è¿˜æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚çš„å€¼çš„æˆ‘ä»¬å­¦ä¹ çš„ã€‚

- isCollapseï¼šNavBar ä¸­ç‚¹å‡»æŒ‰é’®ï¼Œä¼šä¿®æ”¹ Cookie ä¸­çš„ sidebarStatusï¼Œä» vuex å–å€¼æ—¶ä¼šå°† sidebarStatus è½¬ä¸º Booleanï¼Œå¹¶åˆ¤æ–­é»˜è®¤æ˜¯å¦éœ€è¦æ”¶ç¼©å·¦ä¾§èœå•æ 
- showLogoï¼šåˆ¤æ–­ settings.js ä¸­çš„é…ç½®é¡¹æ˜¯å¦éœ€è¦å±•ç¤º Logo
- variablesï¼šä» `@/styles/variables.scss` ä¸­è·å– scss å¯¹è±¡ï¼Œä»è€Œè·å–æ ·å¼



- èœå•æ˜¯å¦å±•ç¤º
- åŒºåˆ†èœå•ä¸­çš„è·³è½¬æ˜¯è·¯ç”±è¿˜æ˜¯å¤–é“¾
- é€šè¿‡è·¯ç”±è¡¨ä¸­çš„childrenæ¥é€’å½’å®ç°æ— é™æèœå•
- é€šè¿‡è·¯ç”±è¡¨ä¸­hiddenæ¥åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ç»„ä»¶åˆ°èœå•ä¸­
- å½“è·¯ç”±ä¸­åªæœ‰ä¸€ä¸ªå­çº§åˆ—è¡¨å°±å°†å­åˆ—è¡¨å½“åšçˆ¶åˆ—è¡¨å±•ç¤º 

**templateéƒ¨åˆ†**

é¦–å…ˆæœ€å¤–å±‚å°±æ˜¯é€šè¿‡hiddenå±æ€§æ¥åˆ¤æ–­æ˜¯å¦è¦æ¸²æŸ“èœå•ï¼Œæ‰€ä»¥é…ç½®hiddenæ˜¯å‹æ ¹ä¸ä¼šæ¸²æŸ“ç»„ä»¶çš„

```vue
<div v-if="!item.hidden">
 
</div>
```

å½“è·¯ç”±ä¸­åªæœ‰ä¸€ä¸ªå­çº§åˆ—è¡¨å°±å°†å­åˆ—è¡¨å½“åšçˆ¶åˆ—è¡¨å±•ç¤º 

```vue
<template v-if="hasOneShowingChild(item.children,item) &&(!onlyOneChild.children||onlyOneChild.noShowingChildren)&&!item.alwaysShow">
 
</template>
```

å¯¹äº`hasOneShowingChild`æ–¹æ³•é‡Œé¢æ³¨é‡Šå…¶å®å†™çš„å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š

- å½“å­çº§è·¯ç”±æ²¡æœ‰è®¾ç½®hidden
- å­çº§è·¯ç”±ä¿æŒä¸€ä¸ª
- è·¯ç”±è¡¨ä¸­ä¸è®¾ç½®`alwaysShow: true`

å†…éƒ¨é€šè¿‡`resolvePath`æ–¹æ³•æ¥åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯å¤–é“¾

```js
// isExternal => åˆ¤æ–­æ˜¯å¦æ˜¯å¤–é“¾æ˜¯å¦åˆæ³•çš„æ­£åˆ™  /^(https?:|mailto:|tel:)/
resolvePath(routePath) {
  if (isExternal(routePath)) {
    return routePath
  }
  if (isExternal(this.basePath)) {
    return this.basePath
  }
  return path.resolve(this.basePath, routePath)
}
```

## è‡ªå·±åŠ¨æ‰‹å®ç°ç™»å½•åŠŸèƒ½

> é€šè¿‡ä¸Šé¢çš„è®²è§£å¤§å®¶åº”è¯¥å¯¹ç™»å½•åŠŸèƒ½äº†è§£çš„å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬å¼€å§‹è‡ªå·±åŠ¨æ‰‹æ¥æ­ä¸ªåå°æœåŠ¡(`node.js`)å®ç°ç™»å½•æ¥å£

åœ¨å¼€å§‹å‰å‡†å¤‡çš„å·¥ä½œ

- å°†mockæ•°æ®apiåˆ æ‰
- ä¿®æ”¹vue.config.jsä¸­çš„é…ç½®
- è‡ªå·±å»ºä¸ª`user/login`è¯·æ±‚APIçš„æ–¹æ³•

ä¸æ‡‚çš„å°ä¼™ä¼´å¯ä»¥çœ‹`vue.config.js`çš„[æ–‡æ¡£](https://panjiachen.github.io/vue-element-admin-site/zh/guide/essentials/mock-api.html#%E6%96%B0%E6%96%B9%E6%A1%88)

### åå°æœåŠ¡æ­å»ºå·¥ä½œ

> è€ƒè™‘åˆ°æœ‰äº›å°ä¼™ä¼´å¯èƒ½æš‚æ—¶æ²¡æœ‰å­¦nodeæ‰€ä»¥æˆ‘è¿™é‡Œæä¾›äº†åå°æœåŠ¡ä»£ç ï¼Œæ”¹ä¸‹é…ç½®é¡¹å°±èƒ½ç”¨ï¼Œå¯¹äºè¦æ”¹çš„é…ç½®é¡¹å¯ä»¥çœ‹æˆ‘å†™çš„æ–‡æ¡£ï¼Œå¯¹äºè¿™éƒ¨åˆ†å°±ä¸è¿‡å¤šè®²äº†

**ä»£ç ä»“åº“ï¼šhttps://github.com/it-beige/book_node**

**æ–‡æ¡£åœ°å€ï¼šhttp://www.beige.world/project/**

> åœ¨çº¿å‘å¾®ï¼Œå¦‚æœè§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯æ¬¢è¿å¤§å®¶ç‚¹ä¸ªèµğŸ‘»

## ç¬¬ä¸‰æ–¹ç™»å½•

### Github

> å»ºè®®å…ˆæŠŠæ–‡æ¡£è¿‡ä¸€ç¯‡ï¼Œå¤§æ¦‚æœ‰ä¸ªäº†è§£ä¹‹åä¸‹é¢å¼€å§‹ä¼šéå¸¸å®¹æ˜“ç†è§£ [gitHup æ–‡æ¡£](https://docs.github.com/en/free-pro-team@latest/developers/apps/building-oauth-apps)ï¼š 

æ•ˆæœå›¾ğŸ’—

![](./02imgs/aaa.gif)

å‰æœŸå‡†å¤‡ï¼š

- ç”³è¯·OAuth App

æ­¥éª¤å›¾

![](./02imgs/19.png)
![](./02imgs/20.png)
![](./02imgs/21.png)
![](./02imgs/22.png)

> æ³¨æ„âš ï¼šè¿™é‡Œæœ‰ä¸ªå‘éœ€è¦æ³¨æ„ä¸‹ï¼Œ**gitHubå›è°ƒurlå¹¶ä¸èƒ½æ”¯æŒVueRouterè¿™ç§ Url`/#/`  å› ä¸ºè¿™æœ¬å°±ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„URI**

éœ€è¦æ”¹æˆè¿™ç§: `http://book.beige.world/login`ï¼Œ è¿™é‡Œç»™å‡ºä¸¤ç§è§£å†³æ–¹æ¡ˆ

- vue-routerä¸­modeè®¾ç½®æˆhistory(é€šè¿‡window.localtionAPIå®ç°è·¯ç”±è·³è½¬)
- ç»§ç»­ä½¿ç”¨/#/è¿™ç§æ–¹å¼ï¼Œåç»­åœ¨è·¯ç”±å‰ç½®é’©å­ä¸­è¿›è¡Œæ‹¦æˆªï¼Œå°†codeæˆªå–å‡ºæ¥

> è¿™é‡Œè¿˜æ˜¯åå‘äºç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§éœ€è¦åç«¯æ”¯æŒï¼Œæœ€èµ·ç å¾—æä¾›ä¸€ä¸ªè¯·æ±‚ä¸å­˜åœ¨çš„URIçš„ç»Ÿä¸€å¤„ç†ã€‚å½“modeä¸ºhistoryæ„å‘³ç€ä½ URIä¸­çš„è®¿é—®è·¯å¾„éƒ½æ˜¯è®¿é—®æ–‡ä»¶ï¼Œå¿…é¡»ä¿è¯æœ‰æ•ˆ

![ç¬¬ä¸€ç§æ–¹å¼å¼Šç«¯](./02imgs/3.gif)

![ç¬¬äºŒç§æ–¹å¼å¼Šç«¯](./02imgs/25.png)

> gitHub(ä¸­æ§å¹³å°)è·³è½¬åˆ°æŒ‡å®šredirect_urlå¹¶ä¸”å°†codeè¿”å›çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡å®š`http:localhost:9527/login`å¯¼è‡´codeæ”¾åœ¨äº†urlé‡Œé¢ï¼Œå…¶å®æˆ‘ä»¬é€šè¿‡`route`æ˜¯è·å–ä¸åˆ°å‚æ•°çš„åªèƒ½å†™æ­£åˆ™è¿›è¡Œæˆªå–å‡ºæ¥

ç”³è¯·å®Œæˆä¹‹åæˆ‘ä»¬å¤§æ¦‚äº†è§£ä¸‹ç¬¬ä¸‰æ–¹ç™»å½•æ ¸å¿ƒOathu2.0ï¼Œå¸¸ç”¨äºæˆ‘ä»¬å¤šç³»ç»Ÿå¼€å‘åšç»Ÿä¸€è®¤è¯å¤„ç†ã€‚

**æµç¨‹å›¾**

![å¤šç³»ç»Ÿç»Ÿä¸€è®¤è¯å¤„ç†](./02imgs/sso-login.jpg)

è¿™é‡Œçš„GitHubç±»ä¼¼äºä¸­æ§å¹³å°ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è®¤è¯ä¸­æ§å¹³å°æ¥åšå¤šæœåŠ¡çš„è®¤è¯å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ç¬¬ä¸‰æ–¹å¹³å°æä¾›å¥½çš„æ¥å£æµç¨‹ä¼šç®€å•å¾ˆå¤šã€‚

![ç¬¬ä¸‰æ–¹ç™»å½•æµç¨‹](./02imgs/23.png)

**ä¸»è¦å°±æ˜¯ä¸Šé¢æµç¨‹ï¼Œ æˆ‘ä»¬éœ€è¦è°ƒç”¨3ä¸ªæ¥å£**

å‰ç«¯å·¥ä½œæ¯”è¾ƒç®€å•å°±æ˜¯ï¼Œæ”¾ä¸€ä¸ªæŒ‰é’®å†™ä¸€ä¸ªæ–¹æ³•è·³è½¬åˆ°gitHubè¿›è¡Œè®¤è¯

```js
gitHubHandleClick(thirdpart) {
  // å‡†å¤‡å‚æ•°
  const client_id = 'Iv1.xxxxxx'
  const redirect_uri = encodeURIComponent('http://book.beige.world/#/login')
  // const redirect_uri = encodeURIComponent('http://localhost:9527/#/login') // æœ¬åœ°æµ‹è¯•çš„æ—¶å€™å¯ä»¥ç”¨è¿™ä¸ª
  const url = 'https://github.com/login/oauth/authorize?client_id=' + client_id + '&redirect_uri=' + redirect_uri
  // openWindow(url, thirdpart, 540, 540)
}
```

> è¿™é‡Œè¯´ä¸€ä¸‹å› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½ä¸€æ¬¡å°±æˆåŠŸï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¿®æ”¹æˆ‘ä»¬ä¹‹å‰ç”³è¯·çš„`OAuth App`å›è°ƒåœ°å€ä¸ºå½“å‰çš„æœ¬åœ°é¡µé¢ï¼Œä¾‹ï¼šhttp://localhost:9527/login ç­‰æµ‹è¯•é€šè¿‡å†æ”¹æˆä½ ä¸Šçº¿åçš„åœ°å€(è¿™é‡Œåé¢è·³è½¬çš„æ—¶å€™ä¼šæœ‰ç‚¹å°é—®é¢˜)

![æœ¬åœ°æµ‹è¯•æ”¹å›è°ƒåœ°å€](./02imgs/24.png)

åç«¯å®ç°ç¬¬ä¸‰æ–¹ç™»å½•æ¥å£

> å…¶å®ä¸»è¦çš„å·¥ä½œè¿˜æ˜¯æ”¾åœ¨åç«¯åšçš„ï¼Œè¿™é‡Œè´´ä¸‹æˆ‘å†™çš„ä»£ç é€»è¾‘ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»[gitHubä»“åº“](https://github.com/it-beige/book_node)downä¸‹æ¥

**è®¾ç½®gitHubé…ç½®ä¿¡æ¯**

```js
let githubConfig = {
  // å®¢æˆ·ID
  client_ID: 'Iv1.dxxxxadasd',
  // å®¢æˆ·å¯†åŒ™
  client_Secret: '395sxxxxxxxxxxxxxxb5bc9ed385',
  // è·å– access_token
  // eg: https://github.com/login/oauth/access_token?client_id=7***************6&client_secret=4***************f&code=9dbc60118572de060db4&redirect_uri=http://manage.hgdqdev.cn/#/login
  access_token_url: 'https://github.com/login/oauth/access_token',
  // è·å–ç”¨æˆ·ä¿¡æ¯
  user_info_url: 'https://api.github.com/user?',
  // å›è°ƒåœ°å€
  //  redirect_uri: 'http://book.beige.world'
  redirect_uri: 'http://localhost:9527/login' // -> æœ¬åœ°æµ‹è¯•
}
```

```js
router.get('/thirdpart/login', async function (req, res, next) {
  console.log(req.query.code);
  if (!req.query.code) return;
  request({
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      url: githubConfig.access_token_url,
      form: {
        client_id: githubConfig.client_ID,
        client_secret: githubConfig.client_Secret,
        code: req.query.code,
        redirect_uri: githubConfig.redirect_uri
      }
    },
    function (error, response, body) {
      console.log(`------------->${body}`);
      let params = body && JSON.parse(body)
      if (!error && response.statusCode == 200) {
        let urlStr = githubConfig.user_info_url + body;
        try {
          request({
              url: urlStr,
              headers: {
                'User-Agent': 'it-beige',
                'Authorization': `bearer ${params.access_token}`
              }
            },
            async function (error, response, resbody) {

              if (!error) {
                let data = JSON.parse(resbody)
                // console.log(data);
                const user = await userService.findUser({
                  username: data.login
                })
                // ç¬¬ä¸€æ¬¡gitHubæˆæƒå‘æ•°æ®åº“å­˜å…¥ç”¨æˆ·æ•°æ®
                if (!user) {
                  db.insert({
                    username: data.login,
                    password: md5(`${data.login}${PWD_SALT}`),
                    role: 'editor',
                    nickname: data.login,
                    avatar: 'http://resource.beige.world/imgs/logo.jpg',
                  }, 'admin_user')
                }

                const token = jwt.sign({
                    username: data.login
                  },
                  PRIVATE_KEY, {
                    expiresIn: JWT_EXPIRED
                  }
                )

                new Result(Object.assign(data, {
                  roles: 'editor',
                  role: 'editor',
                  token,
                  name: data.login,
                  password: md5(`${data.login}${PWD_SALT}`)
                }), 'ç™»å½•æˆåŠŸ').success(res)
              } else {
                new Result(null, 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥').fail(res)
              }
            })
        } catch (e) {
          console.log('1111111111111');
        }
      } else {
        new Result(null, 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥').fail(res)
      }
    }
  )
})
```

### QQ & å¾®ä¿¡

æµç¨‹æ¯”gitHubå¤šä¸€ç‚¹ï¼Œé¦–å…ˆä½ éœ€è¦å¡«å†™èµ„æ–™å®¡æ ¸é€šè¿‡æˆä¸ºå¼€å‘è€…æ‰èƒ½å»åˆ›å»ºåº”ç”¨ï¼Œå®¡æ ¸åœ°å€ï¼šhttps://open.tencent.com/

![](./02imgs/13.png)

> æ³¨æ„âš ï¼šå¦‚æœéœ€è¦å¾®ä¿¡æ¥å…¥åº”ç”¨éœ€è¦å¡«å†™çš„æ˜¯ä¼ä¸šä¿¡æ¯(ä¸ªäººä¹Ÿå¯ä»¥ï¼Œå› ä¸ºæ²¡æœ‰æä¾›äººä¸ªå¡«å†™é¡µé¢)ï¼Œä½†æ˜¯å®¡æ ¸éœ€è¦300å…ƒäººå·¥è´¹ã€‚

![](./02imgs/15.png)

å’³å’³ï¼ŒåŸºäºä¸Šé¢ä¸€ç‚¹æ‰€ä»¥è¿™é‡Œå°±åªæ¼”ç¤ºä¸€ä¸‹QQç¬¬ä¸‰æ–¹ç™»å½•åŠŸèƒ½ï¼Œå…¶å®æµç¨‹éƒ½å¤§å·®ä¸å·®ã€‚



å‰æœŸå‡†å¤‡å¤§å®¶å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« [ QQç¬¬ä¸‰æ–¹ç™»å½•-QQäº’è”å¼€å‘è€…ç”³è¯·çš„å‘ï¼ˆä¸ªäººæ¥å…¥ï¼Œæ—¶é—´ï¼š2019-6-3ï¼‰](https://blog.csdn.net/qq_38496561/article/details/90751768)

![çœ‹åˆ°è¿™ä¸ªçŠ¶æ€å®‰å¿ƒç­‰é€šè¿‡](./02imgs/111.png)

ç¬¬ä¸€æ¬¡å®¡æ ¸å¤±è´¥äº†ğŸ˜“åç»­è¡¥ä¸Šå§....



## å®Œå–„ç™»å½•åŠŸèƒ½ 

æ­¤éƒ¨åˆ†ä¸ºè¡¥ä¸Šåç»­çš„ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå› ä¸ºæ˜¯å­¦ä¹ é¡¹ç›®æ‰€ä»¥è¿˜æ˜¯å°½å¯èƒ½å¤šåšä¸€äº›åŠŸèƒ½ï¼Œç›®å‰æ”¯æŒï¼š`gitHub`ã€`gitee`ã€`ç™¾åº¦`ã€`oschina`ï¼Œæ•´ä½“å®ç°å¤§å·®ä¸å·®ï¼Œå‰ç«¯ä»£ç å°±ä¸è´´äº†ï¼Œè¿™é‡Œä¸»è¦ç»™ä¸‹åç«¯å¯¹äºå¤šä¸ªç¬¬ä¸‰æ–¹ç™»å½•è¯·æ±‚åŒä¸€ä¸ªè·¯ç”±å¤„ç†çš„é€»è¾‘ã€‚

```js
let githubConfig = {
  // è·å– access_token
  access_token_url: 'https://github.com/login/oauth/access_token',
  // è·å–ç”¨æˆ·ä¿¡æ¯
  user_info_url: 'https://api.github.com/user?',

  // æºå¸¦çš„å‚æ•°
  form: {
   // å®¢æˆ·ID
    client_id: 'Iv1.xxxxxxxxxxxxxxx',
    // å®¢æˆ·å¯†åŒ™
    client_secret: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
    // å›è°ƒåœ°å€
    redirect_uri: 'http://localhost:9527/login' // æœ¬åœ°æµ‹è¯•å¯ä»¥ç”¨
  },

  async requestCallBack(res, error, response, body){  // è¯·æ±‚åçš„å¤„ç†å‡½æ•°
    // ä½¿ç”¨codeè·å–åˆ°çš„tokenåçš„æ“ä½œï¼Œå› ä¸ºä¸ªåˆ«å¹³å°é€šè¿‡tokenä¼ å‚æ–¹å¼ä¸åŒï¼Œé¿å…å†™å¤ªå¤šifè¯­å¥ï¼Œå°†å¤„ç†å›è°ƒæŠ½ç¦»
  }
}


let giteeConfig = {
  // è·å– access_tokençš„Url
  access_token_url: 'https://gitee.com/oauth/token',
  // è·å–ç”¨æˆ·ä¿¡æ¯
  user_info_url: 'https://gitee.com/api/v5/user',

  // æºå¸¦çš„å‚æ•°
  form: {
    grant_type: 'authorization_code', // codeç çš„æ–¹å¼
    // å®¢æˆ·ID
    client_id: 'xxxx',
    // å®¢æˆ·å¯†åŒ™
    client_secret: 'xxxx',
    // å›è°ƒåœ°å€
    redirect_uri: 'http://localhost:9527/login' 
  },

  async requestCallBack(res, error, response, body) { 
  },
}

// åŒä¸Š
let tencentConfig = {....xxxxxxx}
let baiduConfig = {....xxxxxxx}
let oschinaConfig = {....xxxxxxx}

let authConfigHash = {
  tencent: tencentConfig,
  gitHuh: githubConfig,
  gitee: giteeConfig,
  baidu: baiduConfig,
  oschina: oschinaConfig,
}
```

**è·¯ç”±çš„ç»Ÿä¸€å¤„ç†**

```js
router.get('/thirdpart/login', async function(req, res, next) {
  let {
    code, // ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å›çš„codeç 
    authType, // ç¬¬ä¸‰æ–¹åº”ç”¨åç§°
  } = req.query
  if (!code) return;
  let config = authConfigHash[authType] // ç¬¬ä¸‰æ–¹åº”ç”¨é…ç½®é¡¹
  if (!config) {next()}
 
  let form = Object.assign({}, config.form, {code})
  request(
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      url: config.access_token_url,
      form
    },
    config.requestCallBack.bind(null, res)
  )
```

åç»­ä¹ŸåŠ ä¸Šäº†éªŒè¯ç å®ç°èµ·æ¥éå¸¸ç®€å•ï¼Œè¿™é‡Œè´´ä¸ªå›¾è®²ä¸‹å¤§æ¦‚çš„å®ç°æ€è·¯å°±å¥½äº†

**æ•ˆæœå›¾ğŸ’—**

![](H:\vue\åå°ç®¡ç†ç³»ç»Ÿ\ã€ä»¥æ¨¡å—åŒ–çš„æ€æƒ³å¼€å‘ä¸­åå°é¡¹ç›®ã€‘\02imgs\33.gif)

- å‰ç«¯é€šè¿‡å‘é€è¯·æ±‚è·å–codeç 
- åç«¯è¿”å›base64æ ¼å¼çš„å›¾ç‰‡ç»™å‰ç«¯å±•ç¤ºï¼Œå“åº”æ—¶å°†codeTextç§åœ¨cookieä¸Šï¼Œæ–¹ä¾¿å‰ç«¯æ ¡éªŒè¯ç åˆæ³•æ€§
- å‰ç«¯é€šè¿‡åç«¯å“åº”çš„æ•°æ®è¿›è¡Œæ ¡éªŒ

è‡³æ­¤è¡¥å……å®Œæˆï¼›è´´ä¸‹ä»“åº“åœ°å€ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æ‹‰ä¸‹æ¥ã€‚

`å‰ç«¯`

- æºç åœ°å€ğŸŒŸï¼š[https://github.com/it-beige/books.git](https://github.com/it-beige/books.git)
- å†å²ç‰ˆæœ¬â­ï¼šd70c055

`åç«¯`

- æºç åœ°å€ğŸŒŸï¼š[https://github.com/it-beige/book_node.git ](https://github.com/it-beige/book_node.git )
- å†å²ç‰ˆæœ¬â­ï¼š3b049c5

# å†™åœ¨æœ€å



å¦‚æœæ–‡ç« ä¸­æœ‰é‚£å—å†™çš„ä¸å¤ªå¥½æˆ–æœ‰é—®é¢˜æ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼Œæˆ‘ä¹Ÿä¼šåœ¨åé¢çš„æ–‡ç« ä¸åœä¿®æ”¹ã€‚ä¹Ÿå¸Œæœ›è‡ªå·±è¿›æ­¥çš„åŒæ—¶èƒ½è·Ÿä½ ä»¬ä¸€èµ·æˆé•¿ã€‚å–œæ¬¢æˆ‘æ–‡ç« çš„æœ‹å‹ä»¬ä¹Ÿå¯ä»¥å…³æ³¨ä¸€ä¸‹

æˆ‘ä¼šå¾ˆæ„Ÿæ¿€ç¬¬ä¸€æ‰¹å…³æ³¨æˆ‘çš„äººã€‚**æ­¤æ—¶ï¼Œå¹´è½»çš„æˆ‘å’Œä½ ï¼Œè½»è£…ä¸Šé˜µï¼›è€Œåï¼Œå¯Œè£•çš„ä½ å’Œæˆ‘ï¼Œæ»¡è½½è€Œå½’ã€‚**



## å¾€æœŸæ–‡ç« 

[ã€å»ºè®®è¿½æ›´ã€‘ä»¥æ¨¡å—åŒ–çš„æ€æƒ³æ¥æ­å»ºä¸­åå°é¡¹ç›®](https://juejin.cn/post/6894412199700201485) 

[ã€å‰ç«¯ä½“ç³»ã€‘ä»ä¸€é“é¢è¯•é¢˜è°ˆè°ˆå¯¹EventLoopçš„ç†è§£](https://juejin.im/post/6868849475008331783) (æ›´æ–°äº†å››é“è¿›é˜¶é¢˜çš„è§£æ)

[ã€å‰ç«¯ä½“ç³»ã€‘ä»åœ°åŸºå¼€å§‹æ‰“é€ ä¸€åº§ä¸‡ä¸ˆé«˜æ¥¼](https://juejin.im/post/6867784542338416648)

[ã€å‰ç«¯ä½“ç³»ã€‘æ­£åˆ™åœ¨å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯å¯ä¸åªæ˜¯è§„åˆ™æ ¡éªŒ](https://juejin.im/post/6867784542338416648)

[ã€Œå‡½æ•°å¼ç¼–ç¨‹çš„å®ç”¨åœºæ™¯ | æ˜é‡‘æŠ€æœ¯å¾æ–‡-åŒèŠ‚ç‰¹åˆ«ç¯‡ã€](https://juejin.im/post/6878941871259779085)

[ã€å»ºè®®æ”¶è—ã€‘cssæ™¦æ¶©éš¾æ‡‚çš„ç‚¹éƒ½åœ¨è¿™å•¦](https://juejin.cn/post/6888102016007176200)